```mermaid
graph TB
    %% Users
    subgraph Users["<b>USERS</b>"]
        Browser["Web Browser<br/>(Desktop/Mobile)"]
        APIClient["API Clients<br/>(Future)"]
    end

    %% CDN & Edge Layer
    subgraph EdgeLayer["<b>EDGE LAYER</b>"]
        CDN["CDN<br/>(Static Assets)<br/>• Images<br/>• JS/CSS Bundles<br/>• Fonts"]
        EdgeCache["Edge Cache<br/>(Next.js ISR)<br/>• Pre-rendered Pages<br/>• Revalidation"]
    end

    %% Frontend Tier
    subgraph FrontendTier["<b>FRONTEND TIER</b><br/>(Vercel / Cloud Platform)"]
        NextJS["Next.js 16 App<br/>(React 19)<br/>• App Router<br/>• Server Components<br/>• API Routes"]
        PrismaClient["Prisma Client<br/>(TypeScript)<br/>• Type-Safe Queries<br/>• Connection Pooling"]
    end

    %% Backend Tier
    subgraph BackendTier["<b>BACKEND TIER</b><br/>(Cloud Run / Lambda / Docker)"]
        EngineAPI["Python Engine API<br/>• FastAPI / Flask<br/>• Orchestration Endpoint<br/>• Health Checks"]
        OrchSystem["Orchestration System<br/>• Query Planner<br/>• Connector Router<br/>• Budget Manager"]
        ExtractionPipeline["Extraction Pipeline<br/>• Parallel Execution<br/>• LLM Integration<br/>• Deduplication"]
        PrismaPython["Prisma Client Python<br/>• ORM Layer<br/>• Transaction Support"]
    end

    %% Database Tier
    subgraph DatabaseTier["<b>DATABASE TIER</b><br/>(Supabase - PostgreSQL)"]
        Primary["Primary Database<br/>• Entity Tables<br/>• RawIngestion<br/>• ExtractedEntity"]
        Replica["Read Replica<br/>(Optional)<br/>• Query Offloading<br/>• Analytics"]
        Backup["Automated Backups<br/>• Point-in-Time Recovery<br/>• Daily Snapshots"]
        ConnectionPool["Connection Pooler<br/>(PgBouncer)<br/>• Max Connections<br/>• Transaction Mode"]
    end

    %% External Services
    subgraph ExternalServices["<b>EXTERNAL SERVICES</b>"]
        AnthropicAPI["Anthropic Claude API<br/>• Structured Extraction<br/>• Instructor Integration<br/>• Rate Limiting"]
        SerperAPI["Serper API<br/>• Web Search<br/>• Entity Discovery"]
        GooglePlacesAPI["Google Places API<br/>• Place Details<br/>• Reviews & Ratings"]
        OSMAPI["OpenStreetMap API<br/>• Geo Data<br/>• Free Tier"]
        SportScotAPI["Sport Scotland API<br/>• Facilities Data<br/>• Public Registry"]
        CustomAPIs["Custom Data Sources<br/>• Vertical-Specific<br/>• Web Scrapers"]
    end

    %% Infrastructure & Operations
    subgraph InfraOps["<b>INFRASTRUCTURE & OPERATIONS</b>"]
        SecretMgr["Secret Manager<br/>• API Keys<br/>• Database Credentials<br/>• Environment Variables"]
        Monitor["Monitoring & Logging<br/>• Error Tracking (Sentry)<br/>• Performance Metrics<br/>• Query Analytics"]
        LoadBalancer["Load Balancer<br/>(Optional)<br/>• Health Checks<br/>• Auto-Scaling"]
    end

    %% Data Flow Connections
    Browser --> EdgeCache
    Browser --> NextJS
    APIClient -.->|"Future"| EngineAPI

    EdgeCache --> CDN
    NextJS --> PrismaClient
    NextJS --> EngineAPI

    EngineAPI --> OrchSystem
    OrchSystem --> ExtractionPipeline
    ExtractionPipeline --> PrismaPython

    PrismaClient --> ConnectionPool
    PrismaPython --> ConnectionPool
    ConnectionPool --> Primary

    Primary --> Replica
    Primary --> Backup

    ExtractionPipeline --> AnthropicAPI
    OrchSystem --> SerperAPI
    OrchSystem --> GooglePlacesAPI
    OrchSystem --> OSMAPI
    OrchSystem --> SportScotAPI
    OrchSystem --> CustomAPIs

    SecretMgr --> NextJS
    SecretMgr --> EngineAPI
    Monitor --> NextJS
    Monitor --> EngineAPI
    LoadBalancer -.->|"Optional"| EngineAPI

    %% Network Boundaries
    Users -.->|"HTTPS"| EdgeLayer
    EdgeLayer -.->|"HTTPS"| FrontendTier
    FrontendTier -.->|"Internal Network<br/>(VPC/Private)"| BackendTier
    BackendTier -.->|"Secure Connection<br/>(SSL/TLS)"| DatabaseTier
    BackendTier -.->|"HTTPS<br/>(API Keys)"| ExternalServices

    %% Styling
    classDef userLayer fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    classDef edgeLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef frontendLayer fill:#e1f5ff,stroke:#0066cc,stroke-width:2px,color:#000
    classDef backendLayer fill:#e8f5e9,stroke:#4caf50,stroke-width:2px,color:#000
    classDef dbLayer fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef externalLayer fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#000
    classDef infraLayer fill:#f5f5f5,stroke:#616161,stroke-width:2px,color:#000

    class Users userLayer
    class EdgeLayer edgeLayer
    class FrontendTier frontendLayer
    class BackendTier backendLayer
    class DatabaseTier dbLayer
    class ExternalServices externalLayer
    class InfraOps infraLayer
```
