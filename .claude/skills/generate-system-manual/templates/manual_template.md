# System Design & Configuration Manual

*This document is the "System Bible" for Edinburgh Finds. It covers the architecture, configuration, operational tools, and logic of the entire repository. Generated by the `generate-system-manual` skill.*

---

## 1. System Overview

Edinburgh Finds is a hyper-local discovery platform built on a "Universal Entity Framework."

### High-Level Architecture
- **Monorepo Structure:**
    - `engine/`: Python-based data processing (Ingestion, Extraction, AI).
    - `web/`: Next.js frontend (User Interface).
    - `prisma/`: Shared database schema.
    - `docs/`: Specialized documentation.

---

## 2. The Data Engine ("The Brain")

The core value of the platform lies in its ability to turn messy web data into structured, trusted entities.

### 2.1 Taxonomy & Classification
*Source: `engine/config/canonical_categories.yaml`*

The system maps chaotic inputs to a strict taxonomy using a "Promotion Workflow."

**Taxonomy Logic:**
{{TAXONOMY_LOGIC_SUMMARY}}

**Current Hierarchy:**
{{TAXONOMY_HIERARCHY}}

### 2.2 Deduplication & Merging
*Source: `engine/extraction/deduplication.py`, `engine/extraction/merging.py`*

**Deduplication Strategy:**
{{DEDUPLICATION_LOGIC}}

**Merging & Trust Levels:**
When sources conflict, "Trust Levels" decide the winner.
{{TRUST_LEVELS_TABLE}}

### 2.3 The LLM Cache
*Source: `engine/extraction/llm_cache.py`*

Semantic caching minimizes costs and latency.
{{CACHE_LOGIC_SUMMARY}}

### 2.4 Pipeline Resilience
*Source: `engine/ingestion/retry_logic.py`, `engine/ingestion/rate_limiting.py`*

- **Retry Logic:** {{RETRY_LOGIC_SUMMARY}}
- **Rate Limiting:** {{RATE_LIMITING_SUMMARY}}

---

## 3. The Frontend (`web/`)

The user-facing application.

**Tech Stack:**
{{FRONTEND_STACK_SUMMARY}}

**Architecture:**
- **App Router:** Next.js 15 structure.
- **Data Access:** Direct DB access via Prisma (Server Components).
- **Styling:** Tailwind CSS.

---

## 4. Configuration & Operations

### 4.1 Monitoring & Alerts
*Source: `engine/config/monitoring_alerts.yaml`*

**Critical Thresholds:**
{{CRITICAL_ALERTS_TABLE}}

**Performance Targets:**
{{PERFORMANCE_TARGETS_SUMMARY}}

### 4.2 Quality Assurance
- **Quarantine:** {{QUARANTINE_LOGIC}}
- **Cost Tracking:** {{COST_LOGIC}}

### 4.3 Testing Strategy
*Source: `conftest.py`, `engine/tests/`*

The project uses `pytest` for the backend.
{{TESTING_STRATEGY_SUMMARY}}

---

## 5. Developer Tools (CLI Reference)

### 5.1 Ingestion CLI (`engine/ingestion/cli.py`)
`python -m engine.ingestion.cli <command>`
{{INGESTION_CLI_COMMANDS}}

### 5.2 Extraction CLI (`engine/extraction/cli.py`)
`python -m engine.extraction.cli <command>`
{{EXTRACTION_CLI_COMMANDS}}

### 5.3 Schema CLI (`engine/schema/cli.py`)
`python -m engine.schema.cli <command>`
{{SCHEMA_CLI_COMMANDS}}

### 5.4 Utility Scripts
- `python -m engine.run_seed`: Seed the DB with initial data.
- `python -m engine.inspect_db`: Debug tool to view DB rows.
- `python -m engine.check_data`: Validation tool.

---

## 6. Documentation Index

A guide to the specialized documents in `docs/`.

{{DOCS_INDEX_TABLE}}

---

## 7. Extensibility Workflows

### Workflow: Add a New Entity Type
1.  **Create Schema:** Add `engine/config/schemas/<entity_name>.yaml`.
2.  **Generate:** `python -m engine.schema.generate`.
3.  **Migrate:** `npx prisma migrate dev`.

### Workflow: Add a New Category
1.  **Analyze:** Check `logs/unmapped_categories.log`.
2.  **Edit:** `engine/config/canonical_categories.yaml`.
3.  **Deploy:** Changes apply on next extraction.