# Edinburgh Finds Lens Configuration
# Defines domain knowledge for sports discovery in Edinburgh

# Schema version (required by architecture.md 6.7 Gate 1)
schema: lens/v1

# Query vocabulary for orchestration
vocabulary:
  activity_keywords:
    - padel
    - tennis
    - squash
    - badminton
    - pickleball
    - racquet sport
    - racket sport

  location_indicators:
    - edinburgh
    - leith
    - portobello
    - stockbridge
    - morningside
    - newington
    - bruntsfield
    - marchmont
    - in
    - near
    - around

  facility_keywords:
    - sports centre
    - sports center
    - leisure centre
    - leisure center
    - sports facility
    - club
    - courts
    - venue

# Connector selection rules for query orchestration
connector_rules:
  sport_scotland:
    priority: high
    triggers:
      - type: any_keyword_match
        keywords: [
          padel, tennis, squash, badminton, pickleball,
          football, rugby, swimming,
          sports, facilities, pools, clubs, centres, centers
        ]

  google_places:
    priority: medium
    triggers:
      - type: location_present
      - type: facility_search

  serper:
    priority: medium
    triggers:
      - type: always

# Facets define how dimensions are interpreted and displayed
facets:
  activity:
    dimension_source: canonical_activities
    ui_label: "Activities"
    display_mode: tags
    order: 1
    show_in_filters: true
    show_in_navigation: true
    icon: "activity"

  place_type:
    dimension_source: canonical_place_types
    ui_label: "Venue Type"
    display_mode: badge
    order: 2
    show_in_filters: true
    show_in_navigation: false
    icon: "building"

# Canonical values registry
values:
  - key: padel
    facet: activity
    display_name: "Padel"
    description: "Racquet sport combining elements of tennis and squash"
    seo_slug: "padel"
    search_keywords: ["padel", "racket sport", "racquet sport"]
    icon_url: "/icons/padel.svg"
    color: "#10B981"

  - key: sports_facility
    facet: place_type
    display_name: "Sports Facility"
    description: "Venue providing sports courts, pitches, or equipment"
    seo_slug: "sports-facility"
    search_keywords: ["sports centre", "sports facility", "leisure centre"]
    icon_url: "/icons/facility.svg"
    color: "#3B82F6"

# Mapping rules (raw data â†’ canonical values)
mapping_rules:
  - id: map_padel_from_name
    pattern: "(?i)padel"
    canonical: "padel"
    confidence: 0.95

  - id: map_sports_facility_type
    pattern: "(?i)(sports\\s*(centre|center|facility|club)|leisure\\s*(centre|center)|padel\\s*(club|centre|center)|padel\\s*courts?)"
    canonical: "sports_facility"
    confidence: 0.85

# Module triggers (when to attach domain modules)
module_triggers:
  - when:
      facet: activity
      value: padel
    add_modules: [sports_facility]
    conditions:
      - entity_class: place

  - when:
      facet: activity
      value: tennis
    add_modules: [sports_facility]
    conditions:
      - entity_class: place

# Module definitions
modules:
  sports_facility:
    description: "Sports facility with courts, pitches, or equipment"
    field_rules:
      - rule_id: extract_padel_court_count
        target_path: padel_courts.total
        extractor: regex_capture
        pattern: "(?i)(\\d+)\\s+(?:fully\\s+)?(?:covered(?:,\\s*|\\s+and\\s+)?)?(?:heated\\s+)?courts?"
        source_fields: [summary, description, entity_name]
        confidence: 0.85
        applicability:
          source: [serper, google_places, sport_scotland]
          entity_class: [place]
        normalizers: [round_integer]

      - rule_id: extract_tennis_court_count
        target_path: tennis_courts.total
        extractor: regex_capture
        pattern: "(?i)(\\d+)\\s*tennis\\s*courts?"
        source_fields: [description, entity_name]
        confidence: 0.85
        applicability:
          source: [serper, google_places, sport_scotland]
          entity_class: [place]
        normalizers: [round_integer]

# Confidence threshold for mapping
confidence_threshold: 0.7
