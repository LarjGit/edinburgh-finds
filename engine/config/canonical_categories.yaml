# Canonical Categories Configuration
#
# This file defines the controlled taxonomy for Edinburgh Finds.
# Raw categories from extractors are mapped to these canonical categories
# to ensure consistent navigation and filtering.
#
# Philosophy:
# - Start narrow (sports venues for Edinburgh)
# - Expand horizontally as new verticals are added
# - Keep taxonomy shallow (2-3 levels max) for usability
# - Prefer specificity over generality

# ============================================================
# CANONICAL TAXONOMY
# ============================================================
#
# Format:
# - category_key: The database value (snake_case, stable identifier)
# - display_name: User-facing label
# - parent: Optional parent category for hierarchical navigation
# - search_keywords: Keywords for text-based search matching
# - description: Internal documentation

taxonomy:
  # ------------------------------------------------------------------
  # ENTITY TYPES (Top Level)
  # ------------------------------------------------------------------
  - category_key: venue
    display_name: Venue
    description: Physical location providing sports facilities or activities
    search_keywords:
      - venue
      - facility
      - center
      - centre
      - location
      - club
      - sports hall
      - complex

  - category_key: retail
    display_name: Retail
    description: Shop or retailer selling sports equipment or apparel
    search_keywords:
      - shop
      - store
      - retail
      - equipment
      - gear
      - pro shop

  - category_key: coach
    display_name: Coach
    description: Individual or organization providing coaching services
    search_keywords:
      - coach
      - instructor
      - trainer
      - teacher
      - lessons
      - academy

  - category_key: club
    display_name: Club
    description: Membership-based sports organization
    search_keywords:
      - club
      - association
      - society
      - team

  - category_key: event
    display_name: Event
    description: Tournament, league, or one-time sporting event
    search_keywords:
      - event
      - tournament
      - competition
      - league
      - match

  # ------------------------------------------------------------------
  # SPORT TYPES (Primary Sports Focus)
  # ------------------------------------------------------------------
  - category_key: padel
    display_name: Padel
    description: Padel courts and facilities
    search_keywords:
      - padel
      - pádel
      - paddle tennis
      - padel court

  - category_key: tennis
    display_name: Tennis
    description: Tennis courts and facilities
    search_keywords:
      - tennis
      - tennis court
      - lawn tennis

  - category_key: squash
    display_name: Squash
    description: Squash courts and facilities
    search_keywords:
      - squash
      - squash court

  - category_key: badminton
    display_name: Badminton
    description: Badminton courts and facilities
    search_keywords:
      - badminton
      - badminton court
      - shuttlecock

  - category_key: pickleball
    display_name: Pickleball
    description: Pickleball courts and facilities
    search_keywords:
      - pickleball
      - pickle ball

  - category_key: table_tennis
    display_name: Table Tennis
    description: Table tennis facilities
    search_keywords:
      - table tennis
      - ping pong
      - tt

  # ------------------------------------------------------------------
  # VENUE SUBTYPES
  # ------------------------------------------------------------------
  - category_key: sports_centre
    display_name: Sports Centre
    parent: venue
    description: Multi-sport facility offering various activities
    search_keywords:
      - sports centre
      - sports center
      - leisure centre
      - leisure center
      - recreation centre
      - multi-sport

  - category_key: gym
    display_name: Gym
    parent: venue
    description: Fitness and gym facilities
    search_keywords:
      - gym
      - fitness
      - health club
      - fitness centre
      - gymnasium

  - category_key: swimming_pool
    display_name: Swimming Pool
    parent: venue
    description: Swimming and aquatic facilities
    search_keywords:
      - swimming pool
      - pool
      - aquatic centre
      - leisure pool

  - category_key: outdoor_pitch
    display_name: Outdoor Pitch
    parent: venue
    description: Outdoor sports pitches and fields
    search_keywords:
      - pitch
      - field
      - outdoor
      - sports ground
      - playing field

  - category_key: private_club
    display_name: Private Club
    parent: venue
    description: Members-only sports clubs
    search_keywords:
      - private club
      - members only
      - membership
      - exclusive

  - category_key: public_facility
    display_name: Public Facility
    parent: venue
    description: Publicly accessible sports facilities
    search_keywords:
      - public
      - council
      - community
      - municipal

  # ------------------------------------------------------------------
  # ADDITIONAL SPORTS (Future Expansion)
  # ------------------------------------------------------------------
  - category_key: golf
    display_name: Golf
    description: Golf courses and facilities
    search_keywords:
      - golf
      - golf course
      - driving range

  - category_key: climbing
    display_name: Climbing
    description: Climbing walls and facilities
    search_keywords:
      - climbing
      - bouldering
      - climbing wall
      - rock climbing

  - category_key: yoga
    display_name: Yoga
    description: Yoga studios and classes
    search_keywords:
      - yoga
      - yoga studio
      - pilates

  - category_key: martial_arts
    display_name: Martial Arts
    description: Martial arts dojos and training facilities
    search_keywords:
      - martial arts
      - karate
      - judo
      - taekwondo
      - dojo
      - kickboxing

# ============================================================
# MAPPING RULES
# ============================================================
#
# These rules map raw categories (from LLM extraction or source data)
# to canonical categories. Rules are applied in order.
#
# Format:
# - pattern: Regex or keyword to match in raw category (case-insensitive)
# - canonical: The canonical category_key to map to
# - confidence: Matching confidence (0-1), used for ambiguous cases

mapping_rules:
  # Entity type mappings
  - pattern: "(?i)\\b(venue|facility|center|centre)\\b"
    canonical: venue
    confidence: 0.8

  - pattern: "(?i)\\b(shop|store|retail|pro shop)\\b"
    canonical: retail
    confidence: 0.9

  - pattern: "(?i)\\b(coach|instructor|academy|lessons)\\b"
    canonical: coach
    confidence: 0.9

  - pattern: "(?i)\\b(club|association|society)\\b"
    canonical: club
    confidence: 0.7  # Lower confidence as "club" can mean many things

  - pattern: "(?i)\\b(event|tournament|competition|league)\\b"
    canonical: event
    confidence: 0.9

  # Sport type mappings
  - pattern: "(?i)\\bp[aá]d[eé]l\\b"
    canonical: padel
    confidence: 1.0

  - pattern: "(?i)\\btennis\\b"
    canonical: tennis
    confidence: 1.0

  - pattern: "(?i)\\bsquash\\b"
    canonical: squash
    confidence: 1.0

  - pattern: "(?i)\\bbadminton\\b"
    canonical: badminton
    confidence: 1.0

  - pattern: "(?i)\\bpickleball\\b"
    canonical: pickleball
    confidence: 1.0

  - pattern: "(?i)\\btable tennis\\b|\\bping[- ]?pong\\b"
    canonical: table_tennis
    confidence: 1.0

  # Venue subtype mappings
  - pattern: "(?i)sports\\s+(centre|center)"
    canonical: sports_centre
    confidence: 0.95

  - pattern: "(?i)leisure\\s+(centre|center)"
    canonical: sports_centre
    confidence: 0.85

  - pattern: "(?i)\\bgym\\b|\\bfitness\\b|health club"
    canonical: gym
    confidence: 0.9

  - pattern: "(?i)swimming\\s+pool|aquatic"
    canonical: swimming_pool
    confidence: 0.95

  - pattern: "(?i)\\bpitch\\b|playing field|sports ground"
    canonical: outdoor_pitch
    confidence: 0.8

  - pattern: "(?i)private|members.only|exclusive"
    canonical: private_club
    confidence: 0.7

  - pattern: "(?i)public|council|community|municipal"
    canonical: public_facility
    confidence: 0.8

  # Additional sports
  - pattern: "(?i)\\bgolf\\b"
    canonical: golf
    confidence: 1.0

  - pattern: "(?i)climbing|bouldering"
    canonical: climbing
    confidence: 1.0

  - pattern: "(?i)yoga|pilates"
    canonical: yoga
    confidence: 0.9

  - pattern: "(?i)martial arts|karate|judo|taekwondo|dojo|kickboxing"
    canonical: martial_arts
    confidence: 0.9

# ============================================================
# PROMOTION WORKFLOW
# ============================================================
#
# Categories flow through 3 stages:
#
# 1. EXTRACTION: Raw categories captured from sources (e.g., "Tennis Club", "Indoor Sports Facility")
#    - Stored in Listing.categories (array of strings)
#    - No filtering or validation at this stage
#
# 2. AUTOMATIC MAPPING: Mapping rules applied to raw categories
#    - Pattern matching against mapping_rules above
#    - Multiple canonical categories can be assigned per listing
#    - Results stored in Listing.canonical_categories (array of strings)
#
# 3. MANUAL REVIEW (Future): Admin interface for category promotion
#    - Review unmapped raw categories
#    - Create new mapping rules or taxonomy entries
#    - Flag incorrect automatic mappings
#
# Design Principles:
# - Preserve raw data: Never modify Listing.categories
# - Fail open: If no mapping matches, leave canonical_categories empty (not null)
# - Multi-label: A venue can have multiple canonical categories (e.g., ["padel", "sports_centre"])
# - Confidence threshold: Only apply mappings with confidence >= 0.7 (configurable)

promotion_config:
  # Minimum confidence for automatic mapping
  min_confidence: 0.7

  # Maximum canonical categories per listing
  max_categories: 5

  # Whether to include parent categories automatically
  # e.g., if "padel" is assigned, also assign "venue"
  include_parents: false

  # Whether to log unmapped categories for manual review
  log_unmapped: true

  # Path for unmapped categories log (relative to project root)
  unmapped_log_path: "logs/unmapped_categories.log"
