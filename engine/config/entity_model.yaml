# Entity Model Configuration — POLICY AND SEMANTIC RULES ONLY
#
# This file defines POLICY and SEMANTIC RULES for the universal entity model.
# It does NOT define storage schema, field types, or indexes.
#
# For storage schema (fields, types, indexes), see: engine/config/schemas/entity.yaml
#
# This file defines:
# - Entity class taxonomy and required capability groups (required_modules)
# - Semantic rules for dimensions (opaqueness, engine interpretation boundaries)
# - Universal module inventory (policy: which modules are universal vs lens-specific)
# - Module applicability rules (which entity_class can use which modules)
#
# IMPORTANT: `required_modules` defines required CAPABILITY GROUPS for an entity_class.
# It does NOT imply anything must appear under the Entity.modules JSONB field.
# Universal fields (location, contact) are top-level columns, NOT in modules JSONB.
# modules JSONB is for lens-specific enrichment only.
#
# Key Principles:
# - entity_class: Universal classification (place, person, organization, event, thing)
# - Dimensions: OPAQUE to engine - no interpretation, lens provides all semantics
# - Modules: Universal modules only (core, location, contact, hours, amenities, time_range)
# - NO domain modules (sports_facility, wine_production - these belong in lens layer)
# - NO vertical-specific concepts (sports, wine, padel, coach, venue, etc.)

# ============================================================================
# ENTITY CLASSES
# ============================================================================
# Every entity has exactly ONE entity_class (required, single-valued)
# Represents what the entity fundamentally IS (not what it DOES)

entity_classes:
  place:
    description: "Physical location with geographic coordinates or address"
    required_modules:
      - core
      - location
    examples:
      - "Physical facility with equipment"
      - "Commercial establishment with seating"
      - "Public space or park"
      - "Retail shop with storefront"

  person:
    description: "Named individual"
    required_modules:
      - core
      - contact
    examples:
      - "Freelance professional"
      - "Independent service provider"
      - "Consultant"

  organization:
    description: "Membership or business entity without fixed physical location"
    required_modules:
      - core
      - contact
    examples:
      - "Membership organization without owned facilities"
      - "Professional association"
      - "Business entity"

  event:
    description: "Time-bounded occurrence with start and end times"
    required_modules:
      - core
      - time_range
    examples:
      - "Competitive event"
      - "Series of sessions"
      - "Workshop or seminar"

  thing:
    description: "Fallback for entities that don't fit other classes"
    required_modules:
      - core
    examples:
      - "Product"
      - "Resource"

# ============================================================================
# DIMENSIONS (Multi-Valued, Opaque) — SEMANTIC RULES ONLY
# ============================================================================
# Dimensions are OPAQUE to the engine - engine does NO interpretation whatsoever.
# The engine only stores and indexes these values; lenses provide ALL semantics.
# For storage schema (Postgres text[] arrays, GIN indexes), see: entity.yaml

dimensions:
  canonical_activities:
    description: "Activities provided/supported (opaque values)"
    notes:
      - "Opaque to engine - lens provides ALL interpretation"
      - "Engine treats as plain opaque strings with no semantic meaning"
      - "Lens-interpreted values stored as plain strings (e.g., ['activity_a', 'activity_b'])"
      - "Vertical-agnostic - same dimension used by all lenses"

  canonical_roles:
    description: "Roles this entity plays (opaque values, universal function-style keys)"
    notes:
      - "Opaque to engine - lens provides ALL interpretation and display labels"
      - "Engine does no interpretation - these are opaque identifiers only"
      - "Universal function-style keys: provides_facility, sells_goods, provides_instruction, membership_org, produces_goods"
      - "Internal-only facet (not shown in UI by default)"
      - "Examples: ['provides_facility', 'membership_org']"

  canonical_place_types:
    description: "Physical place classifications (opaque values)"
    applicable_to:
      - place
    notes:
      - "Opaque to engine - lens provides ALL interpretation"
      - "Engine does no interpretation - these are opaque identifiers only"
      - "Represents container place classification (lens-defined values like 'facility_type_a', 'facility_type_b')"
      - "Individual equipment or sub-facilities belong in domain modules (via lens inventory structures), NOT as place_type values"
      - "Equipment items are NOT place_type values"

  canonical_access:
    description: "Access requirements (opaque values)"
    notes:
      - "Opaque to engine - lens provides ALL interpretation"
      - "Engine does no interpretation - these are opaque identifiers only"
      - "Examples: ['membership', 'pay_and_play', 'free', 'private_club']"

# ============================================================================
# UNIVERSAL MODULES — POLICY INVENTORY ONLY
# ============================================================================
# This section defines which modules are UNIVERSAL (engine-recognized capability groups).
# It does NOT define field schemas - those live in entity.yaml (top-level columns)
# or lens contracts (lens-specific enrichment in modules JSONB).
#
# IMPORTANT: Universal modules listed here are CAPABILITY GROUP NAMES, not JSONB keys.
# Most universal fields (location, contact) are stored as top-level columns, NOT in modules JSONB.
# modules JSONB is for lens-specific enrichment only.
#
# Domain modules (sports_facility, wine_production, etc.) belong in lens layer, NOT here.

modules:
  core:
    description: "Core entity attributes (required for all entities)"
    notes:
      - "Core identity attributes: entity_id, entity_name, slug, summary"
      - "Stored as top-level columns in entity.yaml, NOT in modules JSONB"

  location:
    description: "Physical location attributes"
    applicable_to:
      - place
    notes:
      - "Geographic and address attributes: street_address, city, postcode, country, latitude, longitude, locality"
      - "Stored as top-level columns in entity.yaml, NOT in modules JSONB"

  contact:
    description: "Contact information"
    applicable_to:
      - person
      - organization
      - place
    notes:
      - "Contact attributes: phone, email, website_url, social media URLs"
      - "Stored as top-level columns in entity.yaml, NOT in modules JSONB"

  hours:
    description: "Operating hours"
    applicable_to:
      - place
    notes:
      - "Hours attributes: opening_hours (structured object)"
      - "Stored as top-level columns in entity.yaml, NOT in modules JSONB"

  amenities:
    description: "UNIVERSAL amenities only (NO vertical-specific amenities)"
    applicable_to:
      - place
    notes:
      - "ONLY universal amenities: wifi, parking_available, disabled_access"
      - "NO food service amenities (cafe, restaurant, bar) - these belong in lens layer food_service module"
      - "NO domain-specific amenities"
      - "Stored as top-level columns in entity.yaml, NOT in modules JSONB"

  time_range:
    description: "Time-bounded occurrence attributes"
    applicable_to:
      - event
    notes:
      - "Temporal attributes: start_datetime, end_datetime, timezone, recurrence rules"
      - "Stored as top-level columns in entity.yaml, NOT in modules JSONB"

# ============================================================================
# VALIDATION NOTES
# ============================================================================
#
# ✅ CORRECT (Policy Rules):
# - Universal entity classes (place, person, organization, event, thing)
# - Opaque dimensions with semantic rules (engine does NO interpretation)
# - Universal module capability groups (core, location, contact, hours, amenities, time_range)
# - Universal amenities policy (wifi, parking_available, disabled_access only)
# - Applicability rules (which entity_class can use which modules)
# - required_modules lists (capability groups, NOT JSONB key guarantees)
#
# ❌ FORBIDDEN (Vertical-Specific Concepts):
# - Domain modules: sports_facility, wine_production, fitness_facility, food_service
# - Domain amenities: cafe, restaurant, bar
# - Activity values: padel, tennis, gym, swimming, wine
# - Role labels: Venue, Coach, Retailer, Club (these are display labels in lens only)
# - Storage directives: storage_type, indexed, cardinality (belong in entity.yaml)
# - Schema inventories: attribute names, types, required flags (belong in entity.yaml or lens contracts)
#
# ✅ SEPARATION OF CONCERNS:
# - This file: POLICY and SEMANTIC RULES (what's universal, opaqueness rules, applicability)
# - entity.yaml: STORAGE SCHEMA (field definitions, types, indexes, constraints)
# - Lens contracts: DOMAIN SEMANTICS (vertical-specific modules, interpretation rules)
#
# If this file contains ANY vertical-specific concepts OR storage directives, it violates
# architectural boundaries.
